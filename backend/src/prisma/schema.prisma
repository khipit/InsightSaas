// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  purchases Purchase[]

  @@map("users")
}

model Purchase {
  id                 String            @id @default(cuid())
  userId             String
  type               PurchaseType
  companyId          String
  companyName        String
  status             PurchaseStatus
  purchaseDate       DateTime          @default(now())
  deliveryDate       DateTime?
  reportUrl          String?
  amount             Float
  subscriptionEndDate DateTime?
  trialEndDate       DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("purchases")
}

model News {
  id           String   @id @default(cuid())
  title        String
  content      String?
  summary      String?
  url          String   @unique
  source       String
  author       String?
  publishedAt  DateTime
  category     String?
  tags         String[]
  sentiment    String?
  companyIds   String[] // Related company IDs
  crawledAt    DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("news")
  @@index([publishedAt])
  @@index([source])
  @@index([companyIds])
}

enum PurchaseType {
  SINGLE_REPORT
  SNAPSHOT_PLAN
  CUSTOM_REPORT
  TRIAL
}

enum PurchaseStatus {
  PENDING
  UNDER_REVIEW
  DELIVERED
  FAILED
  COMPLETED
}